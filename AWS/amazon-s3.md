# 1. Amazon S3란?

- Amazon Simple Storage Service
- 객체 스토리지 서비스
    - 객체 스토리지: 데이터를 객체 단위로 관리하는 형식
    - 웹 서버, 회사 내 파일 서버와 같이 인터넷 상에 데이터를 저장하는 장소를 제공해주는 서비스

## 요금 체계

- ‘보유하고 있는 용량’과 ‘전송량’을 기준으로 종량 과금된다.
- 저장 용량
    - S3에 저장된 용량에 대한 비용
    - 스토리지 클래스에 따라 일단위로 나눔하여 계산하는 경우와 30일 단위, 90일 단위, 180일 단위로 계산하는 경우 등 방식이 다양하다.
    - 스토리지 클래스에 따라 최소 용량 요금이 설정되어 있는 경우도 있다.
- 전송용량
    - S3에서 파일을 받거나 보낼 때 발생하는 요금
    - 수신 요청(GET)이나  송신 요청(PUT)에 대해 1GB 단위로 과금

<br/>

# 2. 스토리지 클래스

- S3에는 사용 가능한 스토리지의 종류가 다양하게 존재하며, 스토리지의 종류를 **스토리지 클래스**라고 한다.

## 2.1. 스토리지 클래스 종류

- 어떤 스토리지 클래스를 사용하든 내구성은 99.999999999% 보장
- Standard 클래스 외에는 최소 저장 기간에 대한 요금이 설정되어 있음
- Standard 클래스와 Intelligent-Tiering 이외에는 최소 용량 요금 및 검색 요금이 설정되어 있음
    
    ### Standard
    
    - 3곳 이상의 AZ(가용 영역)에 데이터가 저장되어 있기 때문에 99.9%의 가용성(시스템이 계속해서 가동하는 것)을 보장
    - 데이터를 검색할 때의 요금과 최소 용량(최소량)의 요금이 없고 일할로 계산됨
    
    ### Intelligent-Tiering
    
    - 빈번한 엑세스와 간헐적 엑세스에 최적화된 두 가지 계층에 객체(파일)를 저장한다.
    - 어느 쪽에 저장할지는 객체 별로 모니터링하여 그 결과에 따라 자동으로 이동된다.
        - 한 달 이상 엑세스가 없음 → 간할적 엑세스 계층으로 이동
        - 다시 엑세스가 늘어남 → 빈번한 엑세스 계층으로 이동

<br/>

# 4. 객체와 버킷

## 4.1. 객체와 버킷

### 객체

- 객체는 파일에 빗대어 생각해 볼 수 있다.
- 단순한 파일이 아니라 관리를 위한 메타데이터도 함께 담겨 있다.
- 버킷 하나에 저장할 수 있는 객체 수는 제한이 없고 총 용량에도 제한이 없다.

### 버킷

- 버킷은 윈도우의 C드라이브, D드라이브와 같이 드라이브의 개념에 빗대어 생각해 볼 수 있다.
    - 한편, 버킷은 폴더와 같은 개념은 아니기 때문에 버킷 안에 또 다른 버킷을 생성할 수는 없다.

---

- S3 자체가 객체 스토리지이므로 directory에 대한 개념이 존재하지 않는다.
- 따라서, 객체는 버킷 내부에 계층구조가 아닌 병렬로 배치가 된다.
    - 사용자 편의를 위해 관리 콘솔 상에는 폴더로 표시됨(폴더는 생성, 삭제, 업로드, 다운로드 가능)

## 4.2. 버킷 생성과 명명 규칙

- 버킷을 생성한 뒤에는 리전과 버킷명 변경이 불가능하다.
- 버킷명은 전체 S3 내에서 유일한 이름을 가지고 있어야 한다.
    - 좀 더 명확히 하면, 파티션 내 모든 AWS 리전의 모든 AWS 계정에서 고유해야 한다.
    - 파티션은 리전 그룹을 말하며, AWS에는 `aws`(표준 리전), `aws-cn`(중국 리전), `aws-us-gov`(AWS GovCloud(US)) 이렇게 3가지의 파티션이 존재한다.
    - 동일한 파티션 내에서 내가 `apple`이라는 버킷명을 사용하고 싶은데 A라는 계정이 이미 해당 버킷명을 사용하고 있다면, 해당 버킷을 삭제하기 전까지는 `apple`이라는 버킷명은 사용할 수 없다.
- 웹 서버로 S3를 운용하는 경우에는 도메인명이 버킷명으로 활용된다.

### 명명 규칙

```
log-delivery-september-2022
```

- 버킷명은 첫 시작과 마지막에 알파벳이나 숫자를 사용해야 한다.
- 버킷명은 3자 이상 63자 이하여야 한다.
- 소문자, 숫자, 점(.) 및 하이픈(-)으로만 구성할 수 있다.
- 두 마침표를 나란히 붙여 사용하는 것은 불가능하다.
- IP주소 형식은 버킷명으로 사용될 수 없다.
    - e.g., 대표적인 home router IP주소인 192.168.0.1은 사용이 불가능한 버킷명이다.
- 접두사 `xn--`으로 시작하거나 엑세스 포인트 별칭 이름 용도로 예약되어 있는 접미사 `-s3alias`로 끝나서는 안된다.

### 🚨 DNS명명 규칙을 따르는 버킷명

- 정적 웹 사이트 호스팅에만 사용되는 버킷을 제외하고는 버킷 이름에 dot(.)을 사용하는 것은 권장하지 않는다.
- 버킷명에 점이 포함될 경우, 자체 인증서 검증을 수행하지 않는 한 HTTPS를 통한 가상 호스트 스타일 주소 지정(virtual-host style addressing)을 사용할 수 없다.
    - 버킷의 가상 호스팅에 사용되는 보안 안증서가 이름에 점이 있는 버킷에 대해 작동하지 않기 때문

<br/>

# 5. 버킷 정책과 사용자 정책

## 5.1. S3 버킷에 대한 엑세스 제한 설정

### 버킷 정책

- 버킷 단위로 제한
- 특정 버킷에 접속할 수 있는 사용자를 지정

### 사용자 정책

- IAM 사용자 단위로 제한
- 접속 가능한 버킷을 지정

| 💡 사용자가 많을 경우에는 버킷을 지정하고, 버킷이 많은 경우에는 사용자를 지정하는 편이 좋다.

### ACL(엑세스 제어 목록)에 의한 관리 정책

- 자신 외의 다른 AWS 계정의 '읽기/쓰기'에 대해서 '허가' 혹은 '거부'를 설정한 목록

## 5.2. 엑세스 제한의 대상과 내용

누가, 무엇을, 어떤 것에 대해 가능한가 여부를 정하는 기능

![image](https://user-images.githubusercontent.com/27791880/189511370-18dc1b71-c3a0-438a-9e18-d9b92e41cdc6.png)

- 리소스
    - 제한 대상이 되는 버킷 및 객체
    - 아마존 리소스 이름을 사용하여 대상을 식별
- 작업
    - GET(취득), PUT(배치), DELETE(삭제)가 있다.
    - 작업 키워드를 사용하여 지정
- 효과
    - 허가(allow), 거부(deny)를 설정
- 보안 주체
    - 허가 혹은 거부할 사용자 및 계정, 서비스 등

🚨 버킷의 기본 설정은 제 3자가 접근할 수 없지만, 접근을 허용하게 되면 배포할 파일에 누구든 접속할 수 있기 때문에 보안에 유의할 필요가 있다.

<br/>

# 6. 웹 사이트 호스팅

- S3는 단순 HTML이나 이미지로만 구성된 웹사이트 같이 서버에서 스크립트를 처리하지 않는 **정적 웹 사이트**를 호스팅할 수 있다.
- URL을 설정하고 버킷에 누구든지 접속할 수 있도록 버킷을 그대로 웹 사이트로 오픈하면 호스팅이 가능하다.

## 웹 호스팅에 필요한 설정

- 정적 웹 호스팅 활성화
- public access 차단을 해제
- 버킷 정책을 '모든 사용자'로 전환
- 버킷명을 사용할 도메인명으로 지정
- 개인 도메인을 소지한 경우, Amazon Route 53 등의 DNS서비스를 사용하여 설정

<br/>
<br/>

# Reference

* [Amazon Simple Storage Service User Guide](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html)
* [그림으로 이해하는 AWS 구조와 기술](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791165215682&orderClick=LEA&Kc=)