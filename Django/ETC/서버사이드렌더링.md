# 서버사이드렌더링

## Static Sites - until mid 1990s

* 1990년 중반까지는 모두 다 정적 사이트였다.
* 서버에 이미 잘 만들어진 HTML 문서가 있고 사용자가 keeplearning.com 과 같은 주소로 접속하면 서버에 이미 배포되어 있는 HTML 문서를 받아서 보여주는 형식이다.
* 한 가지 문제점은 페이지 내에서 다른 페이지의 링크를 클릭하면 다시 서버에서 해당 페이지에 대한 HTML 문서를 받아와서 페이지 전체가 업데이트 되어야 한다.

## iframe - 1996

* 문서 내에서 또 다른 문서를 담을 수 있는 iframe 태그가 도입되었다.
* 페이지 내에서 부분적으로 문서를 받아와서 업데이트할 수가 있게 되었다.

## XMLHttpRequest - 1998~

* fetch api의 원조 격인 XMLHttpRequest api가 개발되어서 HTML 문서 전체가 아니라 JSON 과 같은 포맷으로 서버에서 가볍게 필요한 데이터만 받아올 수가 있다.
* 해당 데이터를 자바스크립트를 이용해서 동적으로 HTML 요소를 생성한 뒤 페이지에 업데이트하는 방식이다.

## AJAX - 2005

* 위에서 다룬 방식이 공식적으로 AJAX라는 이름을 가지게 되고 구글에서도 AJAX를 이용해서 gmail이나 google maps와 같은 웹 어플리케이션을 만들기 시작했다. 이것이 SPA(Single Page Application)이다.
* 사용자가 한 페이지 내에 머무르면서 필요한 데이터를 서버에서 받아와서 부분적으로만 업데이트하게 된다. 이러한 방식으로 하나의 어플리케이션을 사용하듯 웹사이트에서도 사용성이 좋아지게 된다.

<br/>

SPA 방식이 널리 사용되고 사용자들의 PC 성능이 좋아짐에 따라 많은 것들을 무리없이 처리할 수 있게 되었다. 또한 자바스크립트도 표준화가 잘 되어짐에 따라 다양한 프레임워크가 나왔다. 이렇게 CSR(Client Side Rendering)가 등장했다.

## CSR(Client Side Rendering)

쉽게 말하자면 클라이언트 측에서 모든 것을 처리하는 것이다.

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        (...생략...)
    </head>
    <body>
        <div id="root"></div>
        <script src="app.js"></script>
    </body>
</html>
```

위의 예시를 보면 body 안에는 `id="root"`와 어플리케이션에서 필요한 자바스크립트 링크만 담겨 있다. html 파일은 비어있기 때문에 처음에 접속하면 빈 화면 밖에 나오지 않는다.

다시 링크된 `app.js`를 서버로부터 다운로드 받게 되고, 이 자바스크립트 파일에는 어플리케이션에서 필요한 로직들 뿐만 아니라 어플리케이션을 구동하는 프레임워크와 라이브러리의 소스코드들도 모두 포함되어 있다. 따라서 굉장히 사이즈가 커서 다운로드 받는데 시간이 소요될 수 밖에 없다. 추가로 필요한 데이터가 있다면 서버에 요청해서 데이터를 받아온 다음, 이것을 기반으로 동적으로 html을 생성해서 사용자에게 최종적인 어플리케이션을 보여주게 된다.

### CSR의 문제점

**첫째**, 사용자가 첫 화면을 보기까지 시간이 오래걸릴 수 있다.

**둘째**, Low SEO(Search Engine Optimization)

구글이나 네이버 같은 검색엔진들은 서버에 등록된 웹사이트들을 하나씩 돌아다니면서 웹사이트에 html문서를 분석한다.

> "여기 html 파일은 어떤 title과 어떤 description이 있으니 어떤 검색어로 찾아질 수 있는 웹사이트이군, 그리고 어떤 링크들이 있으니까 이것도 검색엔진에 등록해야겠다"

이런 식으로 판단해서 검색할 때 웹사이트를 빠르게 검색할 수 있게 도와준다. 하지만, CSR에서 사용하는 대부분의 body는 비어있는 경우가 대다수이다. 따라서 검색엔진은 CSR로 만들어진 웹페이지를 분석하는데 어려움을 겪을 수 밖에 없다.

<br/>

CSR의 Low SEO라는 문제점 때문에 Static Sites에서 영감을 받은 SSR(Server Side Rendering)이 도입된다.

## SSR(Server Side Rendering)

클라이언트에서 모든 것을 처리하던 방식과는 다르게 웹사이트에 접속하면 서버에서 필요한 데이터를 모두 가져와서 html파일을 만들고 이렇게 만들어진 html파일을 동적으로 제어할 수 있는 소스코드와 함께 클라이언트에게 보내준다.

클라이언트 상에서는 잘 만들어진 html 문서를 받아와서 바로 사용자에게 보여줄 수 있게 되는 것이다.

### SSR의 장점

---

1️⃣ SSR을 이용하면 CSR을 사용했을 때보다 첫 번째 페이지 로딩이 빨라지는 장점이 있다.

2️⃣ 모든 컨텐츠가 html에 담겨져 있기 때문에 좀 더 효율적인 SEO가 가능해진다.

그렇다면 SSR은 모든 것의 솔루션이 될 수 있을까? SSR에도 큰 문제점이 있다.

### SSR의 문제점

---

1️⃣ Blinking issue, Non-rich site interactions

사용자가 클릭을 하게 되면 전체적인 웹사이트를 서버에서 받아오는 것과 동일하기 때문에 UX가 좋지 않을 수 있다.

2️⃣ Server side overhead

서버에 과부하가 걸리기 쉽다. 특히, 사용자가 많은 제품일수록 사용자가 클릭을 할 때마다 서버에 요청을 하고 서버에서 필요한 데이터를 가져와서 HTML을 만들기 때문에 서버에 과부하가 걸리기 쉽다.

3️⃣ Fatal issue: Need to wait before interacting

사용자가 빠르게 웹사이트를 확인할 수는 있지만 동적으로 데이터를 처리하는 자바스크립트를 아직 다운로드 받지 못해서 클릭을 했는데도 반응이 없는 경우가 발생할 수 있다. 이러한 문제점에 대해서 이해를 하기 위해서는 TTV(Time To View)와 TTI(Time To Interact)를 이해할 필요가 있다.

<br/>

## CSR과 SSR의 시간의 흐름에 따른 비교

### CSR(Client Side Rendering)

CSR은 사이트에 접속하게 되면, 서버에서 인덱스 파일을 받아오게 된다. 이 index파일은 빈 파일이기 때문에 사용자에게는 아무것도 보여지지 않는다.

이 html 파일에 링크되어 있는 웹사이트에서 필요한 모든 로직이 담겨 있는 자바스크립트를 서버에 요청하게 된다. 그리고 최종적으로 동적으로 html을 생성할 수 있는 웹 어플리케이션 로직이 담긴 자바스크립트 파일을 받아오게 된다.

이러한 과정을 거친 뒤부터 웹사이트가 사용자에게 보여지게 되고 사용자가 클릭이 가능하게 된다. 즉 CSR은 사용자가 웹사이트를 볼 수 있음과 동시에(TTV) 클릭을 하거나 interaction이 가능해진다(TTI).

### SSR(Server Side Rendering)

사이트에 접속을 하면 서버에서 이미 잘 만들어진 `index.html`이라는 인덱스 파일을 받아오게 되고 사용자가 웹사이트를 볼 수 있다(TTV). 하지만 아직 동적으로 제어할 수 있는 자바스크립트 파일을 받아오지 않았기 때문에 사용자가 클릭을 해도 아무것도 처리할 수가 없다.

그래서 최종적으로 자바스크립트 파일을 서버에서 받아와야만 그 때부터 사용자의 클릭을 처리할 수 있는 interaction이 가능해진다(TTI).

이처럼 SSR은 사용자가 사이트를 볼 수 있는 시간(TTV)과 실제로 상호작용할 수 있을 때(TTI)까지의 공백기간이 꽤 긴 편이다.

<br/>

## 성능 개선하기

웹사이트의 성능을 분석할 때 TTV와 TTI도 중요한 지표로 사용할 수가 있다.

CSR을 주로 사용한다면 최종적으로 사용자에게 보내지는 자바스크립트 파일을 어떻게 하면 효율적으로 많이 분할해서 첫 번째로 사용자가 보기 위해서 필요한 정말 필수적인 것만 보낼 수 있을지 고민해보면 좋을 것이다.

SSR은 사용자가 보고 상호작용하는데까지 걸리는 시간을 줄이기 위해 어떤 노력을 할 수 있을지 고민해야할 것이다.

<br/>

## SSG(Static Site Generation)

최근에는 CSR이나 SSR을 고집해서 사용하지 않고 SSG라는 것도 사용한다.

React의 경우 CSR에 특화된 라이브러리이지만 Gatsby라는 라이브러리와 함께 사용하면 리액트로 만든 웹 어플리케이션을 정적으로 웹페이지를 미리 생성을 해두어서 서버에 배포를 해놓을 수 있다. 그리고 이렇게 만들어진 웹사이트는 모두 다 정적인 것도 아니다.

추가적으로 데이터를 서버에서 받아오거나 또는 동적으로 처리해야할 로직이 있다면 자바스크립트 파일을 함께 가지고 있을 수 있기 때문에 동적인 요소도 충분히 추가할 수 있다.

Gatsby 다음으로 React에서 많이 사용되는 것이 Next.js이다. Next.js는 강력한 SSR을 제공하는 라이브러리였지만, 요즘에는 static site generation도 지원하고 CSR과 SSR을 혼합하여 조금 더 유연하게 목적에 맞게 사용할 수 있도록 지원해준다.

<br/>

### Reference

https://youtu.be/iZ9csAfU5Os
